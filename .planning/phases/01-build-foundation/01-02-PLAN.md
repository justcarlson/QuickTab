---
phase: 01-build-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - biome.json
  - package.json
  - .husky/pre-commit
autonomous: true

must_haves:
  truths:
    - "npm run lint checks code with Biome"
    - "npm run format formats code with Biome"
    - "git commit triggers pre-commit hook running lint-staged"
  artifacts:
    - path: "biome.json"
      provides: "Biome linter/formatter configuration"
      contains: "recommended"
    - path: ".husky/pre-commit"
      provides: "Git pre-commit hook"
      contains: "lint-staged"
  key_links:
    - from: "package.json"
      to: "biome.json"
      via: "lint script calls biome"
      pattern: '"lint".*biome'
    - from: ".husky/pre-commit"
      to: "lint-staged"
      via: "npx lint-staged"
      pattern: "lint-staged"
---

<objective>
Configure Biome for linting/formatting and set up Husky pre-commit hooks.

Purpose: Establish code quality enforcement that runs on every commit. This prevents code quality regressions from the start of the migration.

Output: Working Biome configuration with lint and format commands, plus pre-commit hooks that automatically check staged files.
</objective>

<execution_context>
@/home/jc/.claude/get-shit-done/workflows/execute-plan.md
@/home/jc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-build-foundation/01-CONTEXT.md
@.planning/phases/01-build-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Biome linter and formatter</name>
  <files>biome.json, package.json</files>
  <action>
1. Install Biome: `npm install -D @biomejs/biome@^2.3.11`

2. Create biome.json with recommended rules:
```json
{
  "$schema": "https://biomejs.dev/schemas/2.3.0/schema.json",
  "organizeImports": {
    "enabled": true
  },
  "formatter": {
    "enabled": true,
    "indentStyle": "tab",
    "indentWidth": 2,
    "lineWidth": 100
  },
  "linter": {
    "enabled": true,
    "rules": {
      "recommended": true
    }
  },
  "files": {
    "ignore": [
      ".wxt/",
      ".output/",
      "node_modules/",
      "dist/",
      "build/",
      "app/"
    ]
  }
}
```

Note: Ignore legacy directories (build/, app/) that will be removed after migration.

3. Add lint scripts to package.json:
```json
{
  "scripts": {
    "lint": "biome check .",
    "lint:fix": "biome check --write .",
    "format": "biome format --write ."
  }
}
```

4. Run `npm run lint` to verify Biome configuration works (may report issues in any existing .ts files)
  </action>
  <verify>
- `cat biome.json | grep '"recommended": true'` returns match
- `npm run lint` runs without crashing (may have lint warnings)
- `npm run format` runs without crashing
  </verify>
  <done>Biome configured with recommended rules, lint and format scripts added</done>
</task>

<task type="auto">
  <name>Task 2: Set up Husky and lint-staged for pre-commit hooks</name>
  <files>package.json, .husky/pre-commit</files>
  <action>
1. Install Husky and lint-staged:
   `npm install -D husky@^9 lint-staged@^15`

2. Add prepare script and lint-staged config to package.json:
```json
{
  "scripts": {
    "prepare": "husky"
  },
  "lint-staged": {
    "*.{ts,tsx,js,jsx}": ["biome check --write"],
    "*.{json,html,css}": ["biome format --write"]
  }
}
```

Note: Don't include *.md in lint-staged - Biome doesn't format markdown well.

3. Initialize Husky:
   `npm run prepare`

   This creates .husky/ directory.

4. Create pre-commit hook:
   `echo "npx lint-staged" > .husky/pre-commit`

   Or create .husky/pre-commit manually with content:
```bash
npx lint-staged
```

5. Make hook executable:
   `chmod +x .husky/pre-commit`

6. Test the hook by staging a file and running:
   `git add biome.json && npx lint-staged`

   Should show lint-staged processing the file.
  </action>
  <verify>
- `ls -la .husky/pre-commit` shows file exists and is executable
- `cat .husky/pre-commit` contains "lint-staged"
- `cat package.json | grep '"prepare": "husky"'` returns match
- `npx lint-staged` runs without errors (when files are staged)
  </verify>
  <done>Husky initialized with pre-commit hook running lint-staged</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Biome verification:
   - `npm run lint` executes Biome check
   - `npm run format` executes Biome format

2. Pre-commit verification:
   - Stage any TypeScript file: `git add entrypoints/background.ts` (if it exists from Plan 01)
   - Run `npx lint-staged` to simulate pre-commit
   - Hook should run Biome on staged files

3. Configuration verification:
   - biome.json exists with recommended rules
   - .husky/pre-commit exists and is executable
   - package.json has lint-staged configuration
</verification>

<success_criteria>
- npm run lint runs Biome linting without crashing
- npm run format runs Biome formatting without crashing
- Pre-commit hook is installed and executable
- lint-staged configuration targets .ts and .json files
- Biome ignores generated directories (.wxt/, .output/, node_modules/)
</success_criteria>

<output>
After completion, create `.planning/phases/01-build-foundation/01-02-SUMMARY.md`
</output>
